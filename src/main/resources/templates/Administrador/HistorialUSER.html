<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{Administrador/template_administracion.html::head}"></head>

<body>
	<!-- ======== Preloader =========== -->
	<div id="preloader">
		<div class="spinner"></div>

	</div>

	<div th:insert="~{/Administrador/template_administracion.html::sidebar}"></div>

	<div class="overlay"></div>

	<main class="main-wrapper">

		<div th:insert="~{Administrador/template_administracion.html::header}"></div>

		<section class="section">

			<div class="container-fluid">
				<!-- ========== title-wrapper start ========== -->
				<div class="title-wrapper pt-30">
					<div class="row align-items-center">
						<div class="col-md-6">
							<div class="title">
								<h2>Historial de usuarios registradas</h2>
							</div>
						</div>
						<!-- end col -->
						<div class="col-md-6">
							<div class="breadcrumb-wrapper">
								<nav aria-label="breadcrumb">
									<ol class="breadcrumb">
										<li class="breadcrumb-item">
											<a href="#0">Historial</a>
										</li>
										<li class="breadcrumb-item active" aria-current="page">
											Historial de usuarios
										</li>

									</ol>
								</nav>
							</div>
						</div>
						<!-- end col -->
					</div>
					<!-- end row -->
				</div>
				<div class="card-style mb-15">
					<br>

					<!-- end input -->
					<div class="row justify-content-center" data-aos="fade-up" data-aos-delay="300">
						<div class="col-lg-12">
							<div class="form-form-wrapper">
								<div class="text-end mb-3">
									<a class="btn btn-secondary" th:href="@{/Administrador/usuarios}"><i
											class="bi bi-arrow-counterclockwise">Volver</i></a>
									<button class="btn btn-info text-white" data-bs-toggle="modal"
										data-bs-target="#modalFiltros"><i class="bi bi-funnel-fill">Filtro</i>
									</button>

								</div>
								<div class="table-responsive">
									<table class="invoice-table table">
										<thead>
											<tr class="centrados">
												<th scope="col">Nombre completo</th>
												<th scope="col">Documento</th>
												<th scope="col">Rol</th>
												<th scope="col">Ficha</th>
												<th scope="col">Estado</th>

												<th scope="col"> Editar </th>
												<th scope="col"> Eliminar </th>
											</tr>
										</thead>
										<tbody th:each="usuario: ${Usuarios}">
											<tr class="centrados ">
												<td th:text="${usuario.nombre}"></td>
												<td th:text="${usuario.documento}"></td>
												<!---->
												<td th:text="${usuario.rol}"></td>
												<td th:text="${usuario.ficha != null ? usuario.ficha.numFicha : 'N/A'}">
												</td>
												<td>
													<a th:href="@{/Administrador/cambiarEstado/{id} (id = ${usuario.id})}"
														th:text="${usuario.estadoCuenta}"
														th:style="${usuario.estadoCuenta == 'Activo'} ? 'color: #50F527; font-weight: bold;' : 'color: red; font-weight: bold;'">
													</a>
												</td>

												<td><a title="Editar" class="btn btn-warning"
														th:href="@{/Administrador/edicionUsuario/{id} (id=${usuario.id})}">
														<i class="bi bi-pencil-fill"></i></a>
												</td>
												<td><a title="Eliminar" class="btn btn-danger"
														th:href="@{/Administrador/deleteUser/{id} (id=${usuario.id})}">
														<i class="bi bi-trash-fill"></i></a>
												</td>

											</tr>

										</tbody>

									</table>
								</div>

								<div class="d-flex justify-content-center mt-3">
									<nav>
										<ul class="pagination">

											<!-- Botón Anterior -->
											<li class="page-item" th:classappend="${page.first}? 'disabled'">
												<a class="page-link"
													style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 64); border-color: rgb(0, 0, 64);"
													th:href="@{/Administrador/usuarios(
								                        page=${page.number - 1},
								                        nombre=${nombre},
								                        documento=${documento},
								                        rol=${rol},
								                        estado=${estado}
								                    )}">
													Anterior
												</a>
											</li>

											<!-- Mostrar "1" si el rango empieza después de la primera página -->
											<li class="page-item" th:if="${page.number > 5}">
												<a class="page-link"
													style="background-color: aqua; color: rgb(0, 0, 160);" th:href="@{/Administrador/usuarios(
								                        page=0,
								                        nombre=${nombre},
								                        documento=${documento},
								                        rol=${rol},
								                        estado=${estado}
								                    )}">
													1
												</a>
											</li>

											<!-- Mostrar "..." antes si estamos lejos del inicio -->
											<li class="page-item disabled" th:if="${page.number > 5}">
												<span class="page-link">...</span>
											</li>

											<!-- Números dinámicos: solo 10 páginas centradas en la actual -->
											<li class="page-item" th:each="i : ${#numbers.sequence(
								                    page.number > 5 ? page.number - 4 : 0,
								                    page.number + 5 < page.totalPages - 1 ? page.number + 5 : page.totalPages - 1
								                )}" th:classappend="${i == page.number}? 'active'">
												<a class="page-link" th:text="${i + 1}" th:href="@{/Administrador/usuarios(
								                        page=${i},
								                        nombre=${nombre},
								                        documento=${documento},
								                        rol=${rol},
								                        estado=${estado}
								                    )}">
												</a>
											</li>

											<!-- Mostrar "..." después si quedan páginas -->
											<li class="page-item disabled" th:if="${page.number + 6 < page.totalPages}">
												<span class="page-link">...</span>
											</li>

											<!-- Mostrar última página si el rango no la incluye -->
											<li class="page-item" th:if="${page.number + 6 < page.totalPages}">
												<a class="page-link" th:text="${page.totalPages}" th:href="@{/Administrador/usuarios(
								                        page=${page.totalPages - 1},
								                        nombre=${nombre},
								                        documento=${documento},
								                        rol=${rol},
								                        estado=${estado}
								                    )}">
												</a>
											</li>

											<!-- Botón Siguiente -->
											<li class="page-item" th:classappend="${page.last}? 'disabled'">
												<a class="page-link"
													style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 64); border-color: rgb(0, 0, 64);"
													th:href="@{/Administrador/usuarios(
								                        page=${page.number + 1},
								                        nombre=${nombre},
								                        documento=${documento},
								                        rol=${rol},
								                        estado=${estado}
								                    )}">
													Siguiente
												</a>
											</li>

										</ul>
									</nav>
								</div>


							</div>
						</div>
					</div>
					<!-- end input -->
				</div>
				<!-- ========== title-wrapper end ========== -->
			</div>

			<!-- end container -->
		</section>



		<div th:insert="~{Administrador/template_administracion.html::footer}"></div>
		<!-- ========== footer end =========== -->
	</main>
	<!-- ======== main-wrapper end =========== -->

	<div th:insert="~{Administrador/template_administracion.html::jsFiles}"></div>
	<!-- Modal -->
	<div class="modal fade" id="modalFiltros" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">

				<div class="modal-header">
					<h5 class="modal-title">Filtrar Usuarios</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<form th:action="@{/Administrador/usuarios}" method="get">
					<div class="modal-body">

						<div class="row">

							<div class="col-md-12">
								<label>Nombre:</label>
								<input type="text" name="nombre" class="form-control" th:value="${nombre}">
							</div>

							<div class="col-md-12">
								<label>Documento:</label>
								<input type="text" name="documento" class="form-control" th:value="${documento}">
							</div>

							<div class="col-md-6 mt-3">
								<label>Rol:</label>
								<select name="rol" class="form-select">
									<option value="" th:selected="${rol == null}">Todos</option>
									<option value="Administrador" th:selected="${rol == 'Administrador'}">Administrador
									</option>
									<option value="Instructor" th:selected="${rol == 'Instructor'}">Instructor</option>
									<option value="Aprendiz" th:selected="${rol == 'Aprendiz'}">Aprendiz</option>
								</select>
							</div>

							<div class="col-md-6 mt-3">
								<label>Estado:</label>
								<select name="estado" class="form-select">
									<option value="" th:selected="${estado == null}">Todos</option>
									<option value="Activo" th:selected="${estado == 'Activo'}">Activo</option>
									<option value="Inactivo" th:selected="${estado == 'Inactivo'}">Inactivo</option>
								</select>
							</div>

						</div>

					</div>

					<div class="modal-footer">
						<button class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
						<button class="btn btn-info text-white" type="submit">Aplicar Filtros</button>
					</div>

				</form>

			</div>
		</div>
	</div>
</body>

</html>