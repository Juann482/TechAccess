<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{/templates_usuario.html::head}"></head>

<body style="font-family: 'Segoe UI', sans-serif;">

	<header id="header" class="header d-flex align-items-center justify-content-between fixed-top w-100"
		style="background-color: rgb(0, 96, 142, 0.75); box-shadow: 0 5px 3px rgba(0,0,0,0.2); z-index: 999;">
		<div class="container-fluid container-xl d-flex w-100 align-items-center justify-content-between">
			<h1 class="sitename m-0">
				<strong style="color:rgb(243, 243, 243);">TECH</strong>
				<span style="color:rgb(243, 243, 243);">ACCESS</span>
				<span style="color:rgb(189, 196, 202);">/</span>
				<span style="color:#ffffff;">SENA - CIMM CIUDADELA</span>
			</h1>

			<div class="user-profile d-flex align-items-center">
				<!--span class="me-2 text-white fw-bold" th:text="${instructor.nombre}">Instructor</span-->
				<div class="dropdown">
					<a class="d-flex align-items-center text-decoration-none text-white" dropdown-toggle
						data-bs-toggle="dropdown">
						<i class="bi bi-person-circle fs-4"></i>
					</a>
					<ul class="dropdown-menu dropdown-menu-end">
						<li><a class="dropdown-item" th:href="@{/instructor/Inicio}"><i
									class="bi bi-person me-2"></i>Perfil</a>
						</li>
						<li><a class="dropdown-item" th:href="@{/logout}"><i
									class="bi bi-box-arrow-right me-2"></i>Cerrar sesión</a></li>
					</ul>
				</div>
			</div>
		</div>
	</header>

	<!-- Fondo de video -->
	<div class="video-container2 position-fixed top-0 start-0 w-100 h-100" style="z-index:-1;">
		<video class="video-background2 w-100 h-100 object-fit-cover" autoplay muted loop>
			<source src="https://videos.pexels.com/video-files/7946210/7946210-uhd_1440_2732_30fps.mp4">
			Error al cargar el video.
		</video>
	</div>

	<main style="background-color: rgba(0, 128, 192, 0.05); min-height: 100vh; margin-top: 100px;">

		<section class="section" style="background-color:rgba(235, 234, 231, 0.87)">
			<div class="container py-4">
				<div class="row">

					<!-- Panel lateral -->
					<div class="col-lg-3 mb-4">
						<div class="user-nav rounded shadow-sm p-3 bg-white text-center">
							<img th:src="@{/images/instructor.png}" alt="Instructor.img"
								style="width: 120px; border-radius: 50%; border: 2px solid rgb(0, 128, 192);">
							<small class="text-muted"><b>Área:</b> <span>Mecánica</span></small>
							<div class="mt-2">
								<span class="badge bg-success px-3 py-2">Activo</span>
							</div>

							<nav class="nav flex-column mt-4">
								<a th:href="@{/instructor/nvasEntradas}" class="btn btn-outline-info btn-sm mt-2">
									<i class="bi bi-house me-2"></i> Últimas Entradas
								</a>
								<a th:href="@{/instructor/grupos}" class="btn btn-outline-info btn-sm mt-2">
									<i class="bi bi-people me-2"></i> Grupos
								</a>
								<a th:href="@{/instructor/reportes}" class="btn btn-outline-info btn-sm mt-2">
									<i class="bi bi-clipboard-data me-2"></i> Reportes
								</a>
							</nav>
						</div>
					</div>

					<!-- Contenido principal - SOLO EXCUSAS -->
					<div class="col-lg-9">

						<!-- Ponderado -->
						<div class="row mb-4">
							<div class="col-md-13">
								<div class="card text-white bg-info">
									<div class="card-body text-center">
										<h1 th:text="${totalExcusas}">0</h1>
										<p class="mb-0 fs-5">Registro total de Excusas en el Sistema</p>
									</div>
								</div>
							</div>
						</div>

						<!-- Reporte de Excusas -->
						<div class="card">
							<div class="card-header bg-white d-flex justify-content-between align-items-center">
								<h5 class="card-title mb-0">
									<i class="bi bi-file-earmark-text me-2"></i>Reporte de Excusas de Aprendices
								</h5>
								<span class="badge bg-secondary" th:text="${totalExcusas} + ' excusas'">0
									excusas</span>
							</div>
							<div class="card-body">
								<div th:if="${excusas.empty}" class="text-center py-5">
									<i class="bi bi-file-earmark-x fs-1 text-muted"></i>
									<p class="text-muted mt-3">No hay excusas registradas en el sistema</p>
								</div>

								<div th:unless="${excusas.empty}" class="table-responsive">

									<!-- Paginación -->
									<nav th:if="${totalPaginas > 1}">
										<ul class="pagination">
											<!-- PREVIOUS -->
											<li class="page-item"
												th:classappend="${paginaActual == 0} ? 'disabled' : ''">
												<a class="page-link" style="color:cadetblue"
													th:href="@{/instructor/reportes(page=${paginaActual - 1})}">
													&laquo; Anterior
												</a>
											</li>

											<!-- Páginas -->
											<li th:each="i : ${#numbers.sequence(0, totalPaginas - 1)}"
												class="page-item" style="background-color:rgb(212, 212, 212)"
												th:classappend="${i == paginaActual} ? 'active' : ''">
												<a class="page-link"
													style="color:azure; background-color:cadetblue; border-color: rgb(0, 128, 128);"
													th:href="@{/instructor/reportes(page=${i})}" th:text="${i + 1}">
												</a>
											</li>

											<!-- NEXT -->
											<li class="page-item"
												th:classappend="${paginaActual == totalPaginas - 1} ? 'disabled' : ''">
												<a class="page-link" style="color:cadetblue"
													th:href="@{/instructor/reportes(page=${paginaActual + 1})}">
													Siguiente &raquo;
												</a>
											</li>
										</ul>
									</nav>

									<!-- Info de paginación -->
									<div class="text-center text-muted mt-2">
										Página <span th:text="${paginaActual + 1}"></span> de <span
											th:text="${totalPaginas}"></span>
										| Mostrando <span th:text="${excusas.size()}"></span> excusas
									</div>

									<!-- Tabla de Excusas -->
									<table class="table table-striped table-hover">
										<thead class="table-secondary">
											<tr>
												<th>ID</th>
												<th>Motivo</th>
												<th>Descripción</th>
												<th>Fecha</th>
												<th>Aprendiz</th>
												<th>Ficha</th>
												<th>Soporte</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="excusa : ${excusas}">
												<td th:text="${excusa.id}">1</td>
												<td>
													<span th:text="${excusa.motivo}" class="fw-bold text-dark">
														Enfermedad
													</span>
												</td>
												<td>
													<small th:text="${excusa.descripcion}" class="text-muted"
														style="max-width: 200px; display: inline-block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
														Descripción de la excusa...
													</small>
												</td>
												<td th:text="${#temporals.format(excusa.fecha, 'dd/MM/yyyy')}">
													15/04/2024
												</td>
												<td>
													<span th:if="${excusa.usuario != null}"
														th:text="${excusa.usuario.nombre}" class="fw-bold">
														Aprendiz
													</span>
													<span th:if="${excusa.usuario == null}"
														class="text-muted fst-italic">
														Sin aprendiz
													</span>
												</td>
												<td>
													<span th:if="${excusa.ficha != null}"
														th:text="${excusa.ficha.numFicha}" class="badge bg-primary">
														2557863
													</span>
													<span th:if="${excusa.ficha == null}" class="text-muted fst-italic">
														Sin ficha
													</span>
												</td>
												<td>
													<span th:if="${excusa.soporte != null and excusa.soporte != ''}">
														<a th:href="@{'/uploads/' + ${excusa.soporte}}" target="_blank"
															class="badge bg-success">
															<i class="bi bi-file-earmark-arrow-down me-1"></i>Ver
														</a>
													</span>
													<span th:if="${excusa.soporte == null or excusa.soporte == ''}"
														class="badge bg-warning">
														<i class="bi bi-file-x me-1"></i>Sin soporte
													</span>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>

						<!-- Estadísticas -->
						<div class="card mt-4">
							<div class="card-header bg-white">
								<h6 class="card-title mb-0">
									<i class="bi bi-pie-chart me-2"></i>Estadísticas de Excusas
								</h6>
							</div>
							<div class="card-body">
								<div th:if="${!excusas.empty}">
									<div class="row text-center">
										<div class="col-md-3 mb-3">
											<div class="border rounded p-3 bg-light">
												<h4 th:text="${#lists.size(#lists.select(excusas, '${excusa.motivo == \"
													ENFERMEDAD\"}'))}">0</h4>
												<span class="badge bg-danger">ENFERMEDAD</span>
											</div>
										</div>
										<div class="col-md-3 mb-3">
											<div class="border rounded p-3 bg-light">
												<h4 th:text="${#lists.size(#lists.select(excusas, '${excusa.motivo == \"
													CITA MÉDICA\"}'))}">0</h4>
												<span class="badge bg-warning">CITA MÉDICA</span>
											</div>
										</div>
										<div class="col-md-3 mb-3">
											<div class="border rounded p-3 bg-light">
												<h4 th:text="${#lists.size(#lists.select(excusas, '${excusa.motivo == \"
													EMERGENCIA FAMILIAR\"}'))}">0</h4>
												<span class="badge bg-info">EMERGENCIA FAMILIAR</span>
											</div>
										</div>
										<div class="col-md-3 mb-3">
											<div class="border rounded p-3 bg-light">
												<h4 th:text="${#lists.size(#lists.select(excusas, '${excusa.motivo == \"
													OTRO\"}'))}">0</h4>
												<span class="badge bg-secondary">OTRO</span>
											</div>
										</div>
									</div>
								</div>
								<div th:if="${excusas.empty}" class="text-center">
									<p class="text-muted">No hay datos para mostrar estadísticas</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>

	<div th:insert="~{/templates_usuario.html::footer}"></div>
	<div th:insert="~{/templates_usuario.html::jsFiles}"></div>

</body>

</html>