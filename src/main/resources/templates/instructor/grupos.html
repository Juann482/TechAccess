<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:insert="~{/instructor/templates_instructor.html::head}">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<link rel="stylesheet" th:href="@{/css/instructor.css}">
</head>

<body class="index-page">

	<!-- Video de fondo -->
	<div class="video-background">
		<video autoplay muted loop>
			<source src="https://videos.pexels.com/video-files/33113400/14114346_1920_1080_30fps.mp4" type="video/mp4">
		</video>
		<div class="video-overlay"></div>
	</div>

	<!-- Para SIDEBAR en celu -->
	<button class="sidebar-toggle" id="sidebarToggle">
		<i class="bi bi-list"></i>
	</button>

	<div class="dashboard-container">
		<!-- SIDEBAR -->
		<aside class="sidebar" id="sidebar">
			<div class="sidebar-header">
				<div class="logo-container">
					<i class="bi bi-easel2-fill logo-icon"></i>
					<h2>TECH<span>ACCESS</span></h2>
				</div>
				<p>SENA - CIMM CIUDADELA</p>
			</div>

			<!-- Perfil de usuario en sidebar -->
			<div class="user-profile-sidebar">
				<div class="avatar-container">
					<img th:src="@{/images/instructor.png}" alt="Instructor" class="user-avatar">
					<span class="online-status"></span>
				</div>
				<div class="user-info text-center">
					<h4 th:text="${usuario.nombre} ?: 'Instructor'">Instructor</h4>
					<p class="user-role"><b>Área:</b> Mecánica</p>
					<span class="user-status">Activo</span>
				</div>
			</div>

			<!-- Menú de navegación -->
			<ul class="sidebar-nav">
				<li>
					<a th:href="@{/instructor/nvasEntradas}" class="cargando-btn"
						data-mensaje="Cargando últimas entradas...">
						<div class="menu-icon-container">
							<i class="bi bi-house-door"></i>
						</div>
						<span class="menu-text">Últimas Entradas</span>
						<span class="menu-badge" th:text="${entradasHoy ?: 0}">0</span>
					</a>
				</li>
				<li>
					<a th:href="@{/instructor/grupos}" class="active cargando-btn" data-mensaje="Cargando grupos...">
						<div class="menu-icon-container">
							<i class="bi bi-people"></i>
						</div>
						<span class="menu-text">Grupos</span>
						<span class="menu-badge" th:text="${gruposActivos ?: 0}">0</span>
					</a>
				</li>
				<li>
					<a th:href="@{/instructor/reportes}" class="cargando-btn" data-mensaje="Generando reportes...">
						<div class="menu-icon-container">
							<i class="bi bi-clipboard-data"></i>
						</div>
						<span class="menu-text">Reportes</span>
						<span class="menu-indicator">
							<i class="bi bi-chevron-right"></i>
						</span>
					</a>
				</li>
			</ul>

			<!-- Resumen rápido -->
			<div class="sidebar-summary">
				<div class="summary-header">
					<i class="bi bi-graph-up"></i>
					<h5>Resumen Hoy</h5>
				</div>
				<div class="summary-stats">
					<div class="summary-item">
						<div class="summary-info">
							<i class="bi bi-person-check summary-icon present"></i>
							<span>Presentes</span>
						</div>
						<span class="summary-value text-accent" th:text="${entradasHoy ?: 0}">0</span>
					</div>
					<div class="summary-item">
						<div class="summary-info">
							<i class="bi bi-people summary-icon total"></i>
							<span>Total</span>
						</div>
						<span class="summary-value" th:text="${totalAprendices ?: 0}">0</span>
					</div>
					<div class="summary-item">
						<div class="summary-info">
							<i class="bi bi-exclamation-triangle summary-icon alert"></i>
							<span>Alertas</span>
						</div>
						<span class="summary-value text-warning" th:text="${alertas ?: 0}">0</span>
					</div>
				</div>
			</div>
		</aside>

		<!-- CONTENIDO PRINCIPAL -->
		<main class="main-content" id="mainContent">
			<!-- Encabezado superior -->
			<header class="top-header">
				<div class="page-title">
					<div class="welcome-container">
						<h1 class="welcome-text">
							<span class="greeting">Grupos Asignados</span>
							<span class="user-name" th:text="${usuario.nombre} ?: 'Instructor'">Instructor</span>
						</h1>
						<p class="welcome-subtitle">
							<i class="bi bi-people me-2"></i>
							<span th:if="${fichas != null and !fichas.empty}"
								th:text="${fichas.size()} + ' fichas asignadas'">0 fichas asignadas</span>
							<span th:if="${fichas == null or fichas.empty}">Sin grupos asignados</span>
						</p>
					</div>
				</div>

				<div class="header-actions">
					<!-- Búsqueda rápida -->
					<div class="search-container">
						<i class="bi bi-search search-icon"></i>
						<input type="text" class="search-input" placeholder="Buscar ficha o programa...">
					</div>

					<!-- Notificaciones -->
					<div class="notification-bell" id="notificationBell">
						<i class="bi bi-bell"></i>
						<span class="notification-count" th:text="${alertas ?: 0}">0</span>
						<div class="notification-pulse"></div>
					</div>

					<!-- Usuario dropdown -->
					<div class="user-dropdown dropdown">
						<a class="d-flex align-items-center text-decoration-none" dropdown-toggle
							data-bs-toggle="dropdown">
							<div class="user-avatar-mini">
								<img th:src="@{/images/instructor.png}" alt="Instructor">
							</div>
							<div class="user-info-mini">
								<span class="user-name-mini"
									th:text="${usuario.nombre} ?: 'Instructor'">Instructor</span>
								<span class="user-role-mini">Instructor</span>
							</div>
							<i class="bi bi-chevron-down dropdown-arrow"></i>
						</a>
						<ul class="dropdown-menu dropdown-menu-end">
							<li>
								<a class="dropdown-item" href="#" id="perfil-link">
									<i class="bi bi-person me-2"></i>Mi Perfil
								</a>
							</li>
							<li>
								<a class="dropdown-item" href="#">
									<i class="bi bi-gear me-2"></i>Configuración
								</a>
							</li>
							<li>
								<hr class="dropdown-divider">
							</li>
							<li>
								<a class="dropdown-item" th:href="@{/logout}" id="logout-link">
									<i class="bi bi-box-arrow-right me-2"></i>Cerrar sesión
								</a>
							</li>
						</ul>
					</div>
				</div>
			</header>

			<!-- Widgets -->
			<div class="quick-widgets">
				<div class="quick-widget">
					<div class="widget-icon schedule">
						<i class="bi bi-people"></i>
					</div>
					<div class="widget-content">
						<span class="widget-value" th:text="${fichas != null ? fichas.size() : 0}">0</span>
						<span class="widget-label">Fichas Asignadas</span>
					</div>
				</div>

				<div class="quick-widget">
					<div class="widget-icon next-class">
						<i class="bi bi-person-badge"></i>
					</div>
					<div class="widget-content">
						<span class="widget-value" th:text="${totalAprendices ?: 0}">0</span>
						<span class="widget-label">Total Aprendices</span>
					</div>
				</div>
			</div>

			<!-- Contenido principal -->
			<div class="content-section">
				<!-- Panel de grupos -->
				<div class="section-card glassmorphism" style="grid-column: 1 / -1;">
					<div class="section-header">
						<div class="section-title">
							<div class="section-icon activity">
								<i class="bi bi-people-fill"></i>
							</div>
							<div>
								<h3>Grupos Asignados</h3>
								<p class="section-subtitle" th:if="${fichas != null and !fichas.empty}"
									th:text="${fichas.size()} + ' fichas de formación'">
									Fichas de formación asignadas
								</p>
								<p class="section-subtitle" th:if="${fichas == null or fichas.empty}">
									Sin grupos asignados
								</p>
							</div>
						</div>
					</div>

					<div class="section-body">
						<!-- Muestra por ficha -->
						<div th:if="${fichas != null and !fichas.empty}" class="row">
							<!-- Tarjeta individual -->
							<div th:each="ficha : ${fichas}" class="col-md-6 mb-4">
								<div class="glassmorphism rounded p-4 h-100"
									style="border-left: 4px solid var(--accent-color);">
									<div class="d-flex align-items-start mb-3">
										<div class="me-3">
											<i class="bi bi-card-checklist fs-2 text-accent"></i>
										</div>
										<div>
											<h5 class="text-white mb-1"
												th:text="'Ficha ' + ${ficha.nombrePrograma + ficha.numFicha}">
												Ficha Default
											</h5>
											<p class="text-muted small mb-0">
												<i class="bi bi-hash"></i>
												<span th:text="${ficha.numFicha}">0000000</span>
											</p>
										</div>
									</div>

									<div class="mt-3">
										<p class="text-light mb-2">
											<i class="bi bi-book me-2"></i>
											<strong>Programa:</strong>
											<span th:text="${ficha.designacion}">Programa Default</span>
										</p>
										<p class="text-light mb-2" th:if="${ficha.jornada != null}">
											<i class="bi bi-clock me-2"></i>
											<strong>Jornada:</strong>
											<span th:text="${ficha.jornada}">Mañana</span>
										</p>

										<div class="mt-4 d-flex justify-content-between align-items-center">
											<span class="badge bg-success bg-opacity-25 text-success px-3 py-2">
												<i class="bi bi-check-circle me-1"></i> Activo
											</span>
											<button class="btn btn-outline-accent btn-sm">
												Ver detalles <i class="bi bi-arrow-right ms-1"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- ALERTA DE ERROR -->
						<div th:if="${error != null}" class="text-center py-5">
							<div class="empty-state">
								<div class="empty-icon">
									<i class="bi bi-exclamation-triangle text-warning"></i>
								</div>
								<h4 class="text-warning">Sin grupos asignados</h4>
								<p class="text-muted" th:text="${error}">
									No se encontraron fichas asignadas a su cargo.
								</p>
								<div class="mt-4">
									<small class="text-muted">
										<i class="bi bi-info-circle me-1"></i>
										Contacte al área de administración para la asignación de grupos
									</small>
								</div>
							</div>
						</div>

						<!-- MENSAJE PRINCIPAL -->
						<div th:if="${fichas == null and error == null}" class="text-center py-5">
							<div class="empty-state">
								<div class="empty-icon">
									<i class="bi bi-info-circle text-info"></i>
								</div>
								<h4 class="text-info">Bienvenido</h4>
								<p class="text-muted">
									Seleccione "Grupos" en el menú lateral para ver la información de sus fichas
									asignadas.
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
	</div>

	<!-- Footer -->
	<div th:insert="~{/templates_usuario.html::footer}"></div>

	<!-- Archivos JS -->
	<div th:insert="~{/templates_usuario.html::jsFiles}"></div>

	<!-- SweetAlerts Scripts -->
	<script th:inline="javascript">
		/*<![CDATA[*/
		// Variables globales desde Thymeleaf
		const usuarioNombre = /*[[${usuario.nombre}]]*/ 'Instructor';
		const usuarioEmail = /*[[${usuario.email}]]*/ 'instructor@sena.edu.co';
		const alertasCount = /*[[${alertas}]]*/ 0;
		const totalAprendices = /*[[${totalAprendices}]]*/ 0;
		const fichasCount = /*[[${fichas != null ? fichas.size() : 0}]]*/ 0;

		// Actualizar fecha y hora
		function updateDateTime() {
			const now = new Date();
			const options = {
				weekday: 'long',
				year: 'numeric',
				month: 'long',
				day: 'numeric',
				hour: '2-digit',
				minute: '2-digit'
			};
			const dateTimeStr = now.toLocaleDateString('es-ES', options);

			const timeStr = now.toLocaleTimeString('es-ES', {hour: '2-digit', minute: '2-digit'});
		}

		// Toggle sidebar en móvil
		const sidebarToggle = document.getElementById('sidebarToggle');
		const sidebar = document.getElementById('sidebar');
		const mainContent = document.getElementById('mainContent');

		if (sidebarToggle && sidebar) {
			sidebarToggle.addEventListener('click', function (e) {
				e.stopPropagation();
				sidebar.classList.toggle('active');
			});

			// Cerrar sidebar al hacer clic fuera en móvil
			document.addEventListener('click', function (event) {
				if (window.innerWidth <= 768 &&
					sidebar.classList.contains('active') &&
					!sidebar.contains(event.target) &&
					!sidebarToggle.contains(event.target)) {
					sidebar.classList.remove('active');
				}
			});
		}

		// Función para mostrar carga
		function cargando(mensaje) {
			if (typeof Swal !== 'undefined') {
				Swal.fire({
					title: mensaje,
					allowOutsideClick: false,
					showConfirmButton: false,
					backdrop: 'rgba(0, 0, 0, 0.4)',
					didOpen: () => {
						Swal.showLoading();
					}
				});

				// Cierre automático tras 2 segundos
				setTimeout(() => {
					if (Swal && Swal.isVisible()) {
						Swal.close();
					}
				}, 2000);
			}
		}

		// Confirmar logout
		function confirmarLogout(event) {
			event.preventDefault();

			if (typeof Swal !== 'undefined') {
				Swal.fire({
					title: '¿Cerrar sesión?',
					text: "¿Estás seguro de que quieres salir del sistema?",
					icon: 'question',
					showCancelButton: true,
					confirmButtonColor: '#0c2d48',
					cancelButtonColor: '#6c757d',
					confirmButtonText: 'Sí, salir',
					cancelButtonText: 'Cancelar',
					backdrop: 'rgba(0, 0, 0, 0.4)'
				}).then((result) => {
					if (result.isConfirmed) {
						window.location.href = '/logout';
					}
				});
			} else {
				if (confirm('¿Estás seguro de que quieres cerrar sesión?')) {
					window.location.href = '/logout';
				}
			}
		}

		// Mostrar perfil
		function mostrarPerfil() {
			if (typeof Swal !== 'undefined') {
				Swal.fire({
					title: 'Mi Perfil',
					html: `
                        <div class="profile-modal">
                            <div class="profile-header">
                                <img src="/images/instructor.png" alt="Instructor" class="profile-avatar">
                                <div class="profile-status online"></div>
                            </div>
                            <div class="profile-info">
                                <div class="info-item">
                                    <i class="bi bi-person"></i>
                                    <div>
                                        <span class="info-label">Nombre</span>
                                        <span class="info-value">${usuarioNombre}</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-envelope"></i>
                                    <div>
                                        <span class="info-label">Email</span>
                                        <span class="info-value">${usuarioEmail}</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-briefcase"></i>
                                    <div>
                                        <span class="info-label">Área</span>
                                        <span class="info-value">Mecánica</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-people"></i>
                                    <div>
                                        <span class="info-label">Fichas Asignadas</span>
                                        <span class="info-value">${fichasCount}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `,
					icon: 'info',
					confirmButtonColor: '#0c2d48',
					confirmButtonText: 'Entendido',
					backdrop: 'rgba(0, 0, 0, 0.4)',
					showCloseButton: true
				});
			} else {
				alert(`Perfil:\nNombre: ${usuarioNombre}\nEmail: ${usuarioEmail}\nÁrea: Mecánica\nFichas: ${fichasCount}`);
			}
		}

		// Inicializar eventos
		document.addEventListener('DOMContentLoaded', function () {
			// Asignar evento a enlaces de perfil
			const perfilLink = document.getElementById('perfil-link');
			if (perfilLink) {
				perfilLink.addEventListener('click', function (e) {
					e.preventDefault();
					mostrarPerfil();
				});
			}

			// Asignar evento a enlaces de logout
			const logoutLink = document.getElementById('logout-link');
			if (logoutLink) {
				logoutLink.addEventListener('click', confirmarLogout);
			}

			// Asignar eventos a botones de carga
			const cargandoButtons = document.querySelectorAll('.cargando-btn');
			cargandoButtons.forEach(button => {
				button.addEventListener('click', function (e) {
					const mensaje = this.getAttribute('data-mensaje') || 'Cargando...';
					cargando(mensaje);
				});
			});

			// Mostrar alerta de bienvenida
			setTimeout(() => {
				if (typeof Swal !== 'undefined' && fichasCount > 0) {
					Swal.fire({
						title: 'Grupos Cargados',
						text: `Se han cargado ${fichasCount} fichas asignadas correctamente.`,
						icon: 'success',
						confirmButtonColor: '#0c2d48',
						timer: 3000,
						timerProgressBar: true,
						toast: true,
						position: 'top-end',
						showConfirmButton: false,
						backdrop: false
					});
				}
			}, 1000);

			// Efecto de aparición para las tarjetas
			const statCards = document.querySelectorAll('.stat-card, .glassmorphism');
			statCards.forEach((card, index) => {
				setTimeout(() => {
					card.style.opacity = '1';
					card.style.transform = 'translateY(0)';
				}, index * 100);
			});
		});
		/*]]>*/
	</script>
</body>

</html>